RACE CONDITION: Fixed using threading.Lock
MEMORY LEAK: Fixed by clearing cache in processor
N+1 QUERY: Fixed using eager loading (lazy="joined")
DISCOUNT LOGIC: Corrected formula
CODE QUALITY: Refactored structure and cleaned code
